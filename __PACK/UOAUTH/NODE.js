UOAUTH.GENERATE_AUTHORIZATION=METHOD(function(e){"use strict";var t=require("crypto"),r=require("querystring"),o=function(e,r,o){var n=t.createHmac("sha1",e);return n.update(r),n.digest(o)};return{run:function(e){var t=e.url,n=e.method,a=void 0===e.paramStr?{}:r.parse(e.paramStr),u=e.consumerKey,i=e.consumerSecret,s=void 0===e.tokenSecret?"":e.tokenSecret,c=e.token,E=e.verifier,p=RANDOM_STR(42),T=INTEGER(Date.now()/1e3),d={oauth_consumer_key:u,oauth_nonce:p,oauth_signature_method:"HMAC-SHA1",oauth_timestamp:T,oauth_token:c,oauth_verifier:E,oauth_version:"1.0"},m=COMBINE([a,d]),h=Object.keys(m).sort(),_="",O="OAuth ";return EACH(h,function(e,t){void 0!==m[e]&&(_+=""===_?e+"="+encodeURIComponent(m[e]):"&"+e+"="+encodeURIComponent(m[e]))}),_=encodeURIComponent(_),EACH(d,function(e,r){void 0!==e&&("OAuth "===O?O+=r+'="'+encodeURIComponent(e)+'"':("oauth_signature_method"===r&&(O+=', oauth_signature="'+encodeURIComponent(o(i+"&"+s,n+"&"+encodeURIComponent(t)+"&"+_,"base64"))+'"'),O+=", "+r+'="'+encodeURIComponent(e)+'"'))}),O}}}),UOAUTH.GET_JWT_TOKEN=METHOD(function(e){"use strict";var t=require("url"),r=require("crypto");return{run:function(e,o){var n,a,u=e.url,i=t.parse(u),s=e.scopes,c=e.clientEmail,E=e.privateKey,p=INTEGER(Date.now()/1e3),T=p+INTEGER(3600),d={iss:c,scope:s.join(" "),aud:u,exp:T,iat:p},m=new Buffer(STRINGIFY({alg:"RS256",typ:"JWT"})).toString("base64")+"."+new Buffer(STRINGIFY(d)).toString("base64");m+="."+r.createSign("RSA-SHA256").update(m).sign(E,"base64"),void 0!==o&&(CHECK_IS_DATA(o)!==!0?a=o:(n=o.error,a=o.success)),POST({isSecure:"https:"===i.protocol,host:i.hostname===TO_DELETE?void 0:i.hostname,port:i.port===TO_DELETE?void 0:INTEGER(i.port),uri:i.pathname===TO_DELETE?void 0:i.pathname.substring(1),paramStr:"grant_type="+encodeURIComponent("urn:ietf:params:oauth:grant-type:jwt-bearer")+"&assertion="+encodeURIComponent(m),headers:{"Content-Type":"application/x-www-form-urlencoded"}},{error:n,success:function(e){a(PARSE_STR(e))}})}}}),UOAUTH.GET_TOKEN=METHOD(function(e){"use strict";var t=require("url"),r=require("querystring");return{run:function(e,o){var n,a,u=e.url,i=t.parse(u);void 0!==o&&(CHECK_IS_DATA(o)!==!0?a=o:(n=o.error,a=o.success)),POST({isSecure:"https:"===i.protocol,host:i.hostname===TO_DELETE?void 0:i.hostname,port:i.port===TO_DELETE?void 0:INTEGER(i.port),uri:i.pathname===TO_DELETE?void 0:i.pathname.substring(1),headers:{Authorization:UOAUTH.GENERATE_AUTHORIZATION(e)}},{error:n,success:function(e){a(r.parse(e))}})}}});